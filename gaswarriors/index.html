<html>
  <head>
    <title>Minting Example</title>
  </head>
  <body>
     <form name="gaswarriorform">
          <select class="numPick" name="numberPick" id="numberPick" form="gaswarriorform">
          <option value="1">1 Gas Warrior</option>
           <option value="2">2 Gas Warriors</option>
          <option value="3">3 Gas Warriors</option>
          <option value="4">4 Gas Warriors</option>
            <option value="5">5 Gas Warriors</option>
            <option value="6">6 Gas Warriors</option>
            <option value="7">7 Gas Warriors</option>
            <option value="8">8 Gas Warriors</option>
            <option value="9">9 Gas Warriors</option>
            <option value="10">10 Gas Warriors</option>
            <option value="11">11 Gas Warriors</option>
            <option value="12">12 Gas Warriors</option>
            <option value="13">13 Gas Warriors</option>
            <option value="14">14 Gas Warriors</option>
            <option value="15">15 Gas Warriors</option>
          </select>
        </form>
    <br><br>
    <div id="initial">
      <button id="btn-connect" style="display: block; margin: 50px auto;">Connect Wallet</button>
    </div>
    <div id="mint" style="display: none">
      <button id="btn-mint" style="display: block; margin: 50px auto;">Mint</button>
    </div>
    <!-- web3 and web3modal packages -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/web3@1.2.11/dist/web3.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/web3modal@1.9.0/dist/index.js"></script>
    <script type="text/javascript" src="https://unpkg.com/@walletconnect/web3-provider@1.2.1/dist/umd/index.min.js"></script>
    <!-- web3 functionality code -->
    <script type="module">
    import CONTRACT_ABI from "./Contract.json" assert { type: "json" };

const Web3Modal = window.Web3Modal.default;
const WalletConnectProvider = window.WalletConnectProvider.default;
let web3, web3Modal, userAddress;

var wei = 40000000000000000;
var numOfMints = 1;

$("#numberPick").on('change',function(){
          numOfMints=$(this).val();
          wei = numOfMints*40000000000000000;
});

function init() {
  console.log("Initializing example");
  console.log("WalletConnectProvider is", WalletConnectProvider);

  // Check that the web page is run in https (MetaMask won't be available)
  if(location.protocol !== 'https:') {
    document.querySelector("#btn-connect").setAttribute("disabled", "disabled")
    return;
  }

  const providerOptions = {
    walletconnect: {
      package: WalletConnectProvider,
      options: {
        infuraId: "a7ca739399d546a0a44d65c7ec14954e",
      }
    },
  };

  web3Modal = new Web3Modal({
    cacheProvider: false,
    providerOptions, // required
    disableInjectedProvider: false, 
  });
}

async function onConnect() {
  let provider;

  console.log("opening web3modal", web3Modal);

  try {
    provider = await web3Modal.connect();
  } catch(e) {
    console.log("Could not get a wallet connection", e);
    return;
  }

  console.log('connected');
  document.querySelector("#initial").style.display = "none";
  document.querySelector("#mint").style.display = "block";

  web3 = new Web3(provider);
  const accounts = await web3.eth.getAccounts();
  userAddress = accounts[0];
}

async function onMint() {  
  const contract = new web3.eth.Contract(CONTRACT_ABI, "0x2d9a757e4b5a3a9dd7e21f5842eb746766525a9d");

  console.log("minting...");

  try {
    await contract.methods.mint(numOfMints).send({from: userAddress, value: wei});
  } catch(e) {
    console.log(e);
  }
}

window.addEventListener('load', async () => {
  init();
  document.querySelector("#btn-connect").addEventListener("click", onConnect);
  document.querySelector("#btn-mint").addEventListener("click", onMint);
});
    
    </script>
  </body>
</html>
